<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tech Check</title>
    <link rel="icon" type="image/png" href="static/gompei.png">
    <link rel="stylesheet" href="static/styles.css">
</head>
<body>
    <div class="header">
        <img src="static/gompei.png" alt="Gompei" style="width:75px; margin: 0px 40px;">
        TWS Tech Check
        <img src="static/gompei.png" alt="Gompei" style="width:75px; margin: 0px 40px;">
        <div class="nav-buttons">
            <a id="tech-checks-tab" href="/index">Tech Checks</a>
            <p>|</p>
            <a id="shoutouts-tab" href="/shoutout-page">Shoutouts</a>
        </div>
    </div>
    <div class="container">
        <div class="post-box">
            <input type="text" id="name" placeholder="Shoutout Name">
            <input type="text" id="username" placeholder="Your Name">
            <textarea id="message" rows="3" placeholder="What's your shoutout for?"></textarea>
            <button onclick="submitShout()">SHARE</button>
        </div>
        <div class="action-box" style="display: none;" >
            <div class="post-header" style="color:black;">Awesome! See your teammates shoutouts below or click these!</div>
            <!-- TODO LATER ONCE LIVE -->
            <!-- <button onclick="showPrevPosts()" id="old-posts-btn">&#x1F448 See Last Week's Tech Checks &#x1F440</button> -->
            <button onclick="showPostBox()" id="new-post-btn">Give another shoutout?</button>
            <a href="/" id="shoutout-btn">Back to tech checks</a>
        </div>
    </div>
    <div class="container post-list-container">
        <div class="post-header">This Week's Shoutouts!!</div>
        <div class="post-list" id="shoutout-list"></div>
    </div>

    <script>
        // Function to format the timestamp
        function formatTimestamp(isoDate) {
            const date = new Date(isoDate);
            const options = { weekday: 'long', hour: 'numeric', minute: 'numeric', hour12: true };
            return date.toLocaleDateString('en-US', options); // Format to "Monday, 03:45 PM"
        }

        // Fetch and display posts
        async function loadShoutouts() {
            const response = await fetch('/shoutouts');
            const shouts = await response.json();
            const shoutList = document.getElementById('shoutout-list');
            shoutList.innerHTML = '';

            if (shouts.length === 0) {
                // Display a message when there are no posts
                shoutList.innerHTML = '<p style="color: #777; font-style: italic; text-align: center;">No shoutouts yet. Add the first one!</p>';
            } else {
                // Reverse the order of the posts (most recent on the top)
                shouts.reverse().forEach(shout => {
                    const shoutoutElement = document.createElement('div');
                    shoutoutElement.classList.add('post');
                    shoutoutElement.innerHTML = `
                        <div class="name">${shout.name}</div>
                        <div class="username">${shout.username}</div>
                        <div class="timestamp">${formatTimestamp(shout.timestamp)}</div>
                        <div class="message">${shout.message}</div>
                    `;
                    shoutList.appendChild(shoutoutElement);
                });
            }
        }

        // Submit new post
        async function submitShout() {
            const name = document.getElementById('name').value;
            const username = document.getElementById('username').value;
            const message = document.getElementById('message').value;
            if (!name || !message) {
                alert("Please enter both a name to shoutout and a quick message for them");
                return;
            }
            const response = await fetch('/shoutout', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, username, message })
            });
            if (response.ok) {
                document.getElementById('name').value = '';
                document.getElementById('username').value = '';
                document.getElementById('message').value = '';
                document.querySelector('.post-box').style.display = 'none';
                document.querySelector('.action-box').style.display = 'block'; // Show "Old posts" and New Posts buttons
                // document.getElementById('new-post-btn').style.display = 'block'; // Show "New Post" button
                // document.getElementById('old-posts-btn').style.display = 'block'; // Show "New Post" button
                loadShoutouts(); // Reload posts to include the new post
            }
        }

        function showPostBox() {
            document.querySelector('.post-box').style.display = 'block';
            document.querySelector('.action-box').style.display = 'none';
        }

        function showPrevPosts() {
            alert("Oops! This button doesn't actually work yet, shhh...");
        }

        // Initial load
        window.onload = loadPosts;
    </script>
</body>
</html>
